---
title: "World Bank Data Analysis"
author: "Constantin Rusu, Ignacio Carracedo, Nestor Gallo, Avi Subramaniam"
date: "October 24, 2016"
output: html_document
---
<center><img src="http://youth4c.org/wp-content/uploads/2015/03/The-World-Bank-logo.png" width="500"></img></center><br>

#INTRODUCTION
The World Bank is an international organization that aims to defeat poverty in the world (specifically in countries with low to medium income) through means of training, development and loan offerings to countries so that they may "help countries help themselves"[1]. Started in 1944 as an initiative after World War II to rebuild a torn Europe (where the International Bank for Reconstruction and Development was also started), the World Bank currently offers several financial products and services such as:

<ul>
  <li>low interest loans</li>
  <li>low interest credits</li>
  <li>grants for developing countries</li>
  <li>financing through trust fund partnerships</li>
</ul>

The organization focuses on delivering measurable results and in order to do that it leads a powerful initiative for open development. This consists of free access to tools and data that spans over more than 50 years for several macroeconomic and microeconomic factors for countries from all over the globe.

#OBJECTIVE(S)
The world has seen some major shifts in the landscapes of politics, economy and society in the past 10 to 20 years. From the tragic events of September 11 in 2001 and the financial crisis of 2008 to the increasing gap in income equality and the rise of the internet as a universal digital medium, the world that has rebuilt after the second World War is anything if not a dynamic one. Social-economic interconnections (also known as economic globalization) has allowed for these changes to more easily scatter and disseminate all over the world so much so that it is now perfectly reasonable to expect a piece of news one night to result in protests being organized in several places around the world by the break of dawn the following day.<br><br>
Forces of change such as the ones presented so far are, however, unexpected and hard to predict. However, if there is one force of world change that has been relatively consistent since the beginning of mankind it would have to be: population growth. Data from the Population Reference Bureau [2] has attempted to model an answer for the question "How many people have ever lived on Earth?" and started by mapping out the human population (as a best estimate) at a few checkpoint moments throughout human history as can be seen below. (the first column represents the year, the second column represent the estimated population on Earth at that point in time, the third column represents the estimate number of births per one thousand people, the fourth column  represents the number of births between the current in-line year and the previous benchmark point)

What is clear from this table is that the population on Earth seems to be headed in an upwards direction and it therefore poses the question: With the certainty of human population growing, how has this impacted the world we live in?
<br><br>The goal of this paper is to study population growth and analyze how this growth impacts other variables such as mortality rate, arable land, CO2 emissions, energy use, GDP growth, etc. as well as researching the evolution of such factors across several countries through time. It is safe to assume that not all countries are impacted by population growth in the same way but, if anything, this creates an opportunity for digging into an interesting topic and revealing insightful results.<br>
Other than studying population growth we also look to answer questions that include:

<ul>
  <li>Can the growth in CO2 emissions be explained by population growth? If the information is analyzed per capita among certain locations, how do these locations or areas differ in CO2 emissions? </li>
  <li>How did farmland (as a percentage of land in each country) change over the years and what is the impact population growth has brought in this aspect?</li>
  <li>What are the countries that present consistent negative GDP growth in the past years?</li>
  <li>How does the population of 0 to 14 year old vary against the population aged between 15 and 64? How do populations metrics shift and is there a noticeable trend?</li>
  <li>To what extent is mortality rate correlated with CO2 emissions or the use of renewable energy?</li>
</ul>

#DATASET DESCRIPTION
As previously mentioned, The World Bank offers easy access to its publicly available data sets that contain information on a wide array of country indicators for each year where collection of that data was possible. These indicators cover different economic, political, geographical and social metrics that help paint a picture of countries all over the world. 

Considering the aforementioned objectives and scope, for this report we select 15 indicators. These are:

* % Population 0 to 14 years old 
* % Population 15 to 64 years old 
* % Rural population 
* % Urban population 
* Population growth 
* Population total 
* CO2 emissions 
* Energy use
* GDP
* GDP annual growth
* Surface area

We create a single data set using the following process:

* Merge all variables of interest into a single dataset.
* The missing values have been reduced, for this we have eliminated years if the country data was scarce.

#DATASET PREPARATION

To get the final data set we create a script that does the following:

* Reading the `CSV` files of all the 11 indicators
* Renaming variables
* Converting year into a column
* Concatenating all 11 indicators into one `data.frame` which make it easier to check missing values.
* Selecting specific years and countries
* Checking for missing values

First we load the WDI, readr and dplyr libraries:
```{r, message=FALSE, warning=FALSE}
library(WDI)
library(readr)
library(dplyr)
library(tidyr)
```
The descriptions of these packages are as follows:<br>
<ul>
<li>`readr` - Read flat/tabular text files from disk (or a connection)</li>
<li>`dplyr` - A Grammar of Data Manipulation. A fast, consistent tool for working with data frame like objects, both in memory and out of memory.</li>
<li>`tidyr` - An evolution of 'reshape2'. It's designed specifically for data tidying (not general reshaping or aggregating) and works well with 'dplyr' data pipelines.</li>
</ul>
Next, each one of the indicators of interest are read into its respective data frame from the downloaded CSV files.
```{r, message=FALSE, warning=FALSE, echo=FALSE}
# disable scientific notation. Easiear to read
options(scipen=999)
# Read each one fo the indicators into a data frame from the downloaded CSV files (remove manuall first 3 lines of cvs)
setwd("C:/Users/carrai1/Desktop/Master/MA402_Data_Science/Assigment_1/")
pop0.df = read_csv("./data/%_population_0_14_60_15.csv")
pop15.df = read_csv("./data/%_population_15_64_60_15.csv")
poprur.df= read_csv("./data/%_rural_population_60_15.csv")
popur.df= read_csv("./data/%_urban_population_60_15.csv")
co2.df= read_csv("./data/CO2_emisions_60_11.csv")
kmsqr.df= read_csv("./data/km_square_61_15.csv")
popgrowth.df= read_csv("./data/population_growth_60_15.csv")
poptotal.df= read_csv("./data/population_total_60_15.csv")
energy.df= read_csv("./data/energy_use_kg_oil.csv")
gdp_growth.df= read_csv("./data/GDP_growth_annual%.csv")
gdp.df= read_csv("./data/GDP.csv")
```


we All data frames are now put into a list.
```{r}
all.list <- list(pop0.df,pop15.df,poprur.df,popur.df,co2.df,kmsqr.df,
                 popgrowth.df,poptotal.df,energy.df,gdp_growth.df,gdp.df)
```
we create a `data.frame` called `wdi.df`. Then we loop every indicator data frame and:

* Rename columns
* Use function `gather` to set `year` and `value` of the indicator into a column. This will facilitate exploring missing values.
* Concatenate indicator data frame with `wdi.df`


```{r}
wdi.df = data.frame()
for (aux.df in all.list){
  # Rename varibles
  aux.df <- rename(aux.df, country.name = `Country Name`, country.code = `Country Code`,indicator.name = `Indicator Name`,indicator.code = `Indicator Code`)
  # "Gather" the year variables and values into a pair of variables: `year` and `value`
  aux.df <- gather(aux.df, year, value, -country.name, -country.code, -indicator.name, -indicator.code) 
  #Concatenate
  wdi.df <- rbind(aux.df,wdi.df)
}
```

Now we have a single data frame will all the indicators. We Convert the `indicator.code`, `country.code` variables into factors and the `year` variable into an ordered factor:
```{r}
wdi.df$indicator.code = factor(wdi.df$indicator.code)
wdi.df$country.code = factor(wdi.df$country.code)
wdi.df$year = factor(wdi.df$year, ordered=TRUE)
```
```{r, echo=FALSE,warning=FALSE, message=FALSE}
# remove columns we don't need. No need to show this.
wdi.df <- filter(wdi.df, year!="X61")
wdi.df <- filter(wdi.df, country.code!="INX")
```


We select our 5 countries of interest. And after doing some studying of missing values we select 2 complete decades (1992 -2011) to craft a data frame without missing values:

```{r}
#select 5 countries of interest (https://en.wikipedia.org/wiki/BRICS) and years 1992/2011 (2 decades/20 years) 
wdi.df %>% filter(. , country.code %in% c("BRA","CHN","IND","RUS","ZAF")) -> wdi.df
wdi.df <- filter(wdi.df, year>1991 & year<2012)
```

Now we want to create a data frame where we can perform our queries to the data. We want a data frame with a column per indicator. This is the process:

* Drop columns we don't need
* Refactor columns because we don't have all the values we had before selecting countries and years
* Transform data frame to have a column per indicator
* Rename indicators to a more descriptive name easier for the reader

```{r}
drops=c('country.name','indicator.name') # drop columns we don't need
wdi.df = wdi.df[ , !(names(wdi.df) %in% drops)]
wdi.df$country.code = factor(wdi.df$country.code) #refactor
wdi.df$year = factor(wdi.df$year, ordered=TRUE) #refactor
wdi.df$indicator.code = factor(wdi.df$indicator.code, ordered=TRUE) #refactor
wdi.df$value <- as.numeric(wdi.df$value) #column value to numberic

#transform data frame to have a column for each indicator
wdi.df %>% spread(., indicator.code, value) -> wdi.df

#rename indicator columns for better understanding
wdi.df %>% rename(. , surface.km2 =AG.SRF.TOTL.K2,
                  energy.use = EG.USE.PCAP.KG.OE,
                  co2.emission = EN.ATM.CO2E.PC,
                  GDP = NY.GDP.MKTP.CD,
                  GDP.growth = NY.GDP.MKTP.KD.ZG,
                  pop.0.14 = SP.POP.0014.TO.ZS,
                  pop.15.64 = SP.POP.1564.TO.ZS,
                  pop.growth = SP.POP.GROW,
                  pop.total =  SP.POP.TOTL,
                  pop.rural=  SP.RUR.TOTL.ZS,
                  pop.urban =SP.URB.TOTL.IN.ZS 
) -> wdi.df
```

Next, we generate a new indicator we think more useful than "surface of country in km2" which is "population density" (`pop.total / surface.km2`). We then remove `surface.km2` from the data frame:

```{r}
#create new indicator POPULATION DENSITY = POPULATION TOTAL/TOTAL COUNTRY SURFACE
wdi.df %>% mutate(., pop.density = pop.total / surface.km2) -> wdi.df
wdi.df$surface.km2 <- NULL
```

For each indicator we get the quantiles and store it in a different indicator with the same name and `.q` a the end for future use:
```{r}
#get quantiles for all indicators and usen the name of the column + .q
make.ntiles = function (inputvar, n) { 
  inputvar %>%
    quantile(., 
             (1/n) * 1:(n-1),
             na.rm=TRUE
    ) %>%
    c(-Inf, ., Inf) %>%
    cut(inputvar, 
        breaks=., 
        paste("Q", 1:n, sep="")
    ) 
}
wdi.df %>%  mutate(energy.use.q = make.ntiles(energy.use, 4 ),
                   co2.emission.q = make.ntiles(co2.emission, 4 ),
                   GDP.q = make.ntiles(GDP, 4 ),
                   GDP.growth.q = make.ntiles(GDP.growth, 4 ),
                   pop.0.14.q = make.ntiles(pop.0.14, 4 ),
                   pop.15.64.q = make.ntiles(pop.15.64, 4 ),
                   pop.growth.q = make.ntiles(pop.growth, 4 ),
                   pop.total.q =  make.ntiles(pop.total, 4 ),
                   pop.rural.q =  make.ntiles(pop.rural, 4 ),
                   pop.urban.q = make.ntiles(pop.urban, 4 ), 
                   pop.density.q = make.ntiles(pop.density, 4)
                   ) -> wdi.df
```

Now that we have a clean dataset to work with that contains the data we deem of interest.

#VARIABLE SUMMARIES

First, let's check summary statistics of all the indicators:

```{r}
indicators <- c("energy.use", "co2.emission","GDP", "GDP.growth", "pop.0.14", "pop.15.64",
                "pop.growth", "pop.total", "pop.rural", "pop.urban", "pop.density")
summary(wdi.df[indicators])
```

Next, we'll calculate the mean, median, standard deviation, minimum, and maximum of each indicator code per country:

***Energy use***
```{r, warning=FALSE,message=FALSE}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(energy.use), median=median(energy.use), sd=sd(energy.use), max=max(energy.use),min=min(energy.use))
```
***CO2 emisions***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(co2.emission), median=median(co2.emission), sd=sd(co2.emission), max=max(co2.emission),min=min(co2.emission))
```
***GDP annual growth***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(GDP.growth), median=median(GDP.growth), sd=sd(GDP.growth), max=max(GDP.growth),min=min(GDP.growth))
```
***GDP***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(GDP), median=median(GDP), sd=sd(GDP), max=max(GDP),min=min(GDP))
```
***% Population 0 to 14 years old***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(pop.0.14), median=median(pop.0.14), sd=sd(pop.0.14), max=max(pop.0.14),min=min(pop.0.14))
```
***% Population 15 to 64 years old***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(pop.15.64), median=median(pop.15.64), sd=sd(pop.15.64), max=max(pop.15.64),min=min(pop.15.64))
```
***Population growth***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(pop.growth), median=median(pop.growth), sd=sd(pop.growth), max=max(pop.growth),min=min(pop.growth))
```

The only country of all 5 with a negative average is Russia.

***Population total***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(pop.total), median=median(pop.total), sd=sd(pop.total), max=max(pop.total),min=min(pop.total))
```
***% Rural population***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(pop.rural), median=median(pop.rural), sd=sd(pop.rural), max=max(pop.rural),min=min(pop.rural))
```

By observing min and max values we can see how China has the biggest change on rural population which matches the numbers of urban population below. Many Chinese people moved from rural areas to urban areas.

***% Urban population***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(pop.urban), median=median(pop.urban), sd=sd(pop.urban), max=max(pop.urban),min=min(pop.urban))
```
***Population density***
```{r}
wdi.df %>% group_by(country.code) %>% summarise(avg=mean(pop.density), median=median(pop.density), sd=sd(pop.density), max=max(pop.density),min=min(pop.density))
```

India, followed by China, are the countries big highest population density.


Now we do the same but for every year instead:


***Energy use***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(energy.use), median=median(energy.use), sd=sd(energy.use), max=max(energy.use),min=min(energy.use))
```

As expected, being the countries emerging powers, the energy use has an upward trend through the years.

***CO2 emisions***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(co2.emission), median=median(co2.emission), sd=sd(co2.emission), max=max(co2.emission),min=min(co2.emission))
```

The average of CO2 emissions has remained approximately constant during the 2 decades under study.

***GDP annual growth***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(GDP.growth), median=median(GDP.growth), sd=sd(GDP.growth), max=max(GDP.growth),min=min(GDP.growth))
```
***GDP***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(GDP), median=median(GDP), sd=sd(GDP), max=max(GDP),min=min(GDP))
```
***% Population 0 to 14 years old***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(pop.0.14), median=median(pop.0.14), sd=sd(pop.0.14), max=max(pop.0.14),min=min(pop.0.14))
```
***% Population 15 to 64 years old***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(pop.15.64), median=median(pop.15.64), sd=sd(pop.15.64), max=max(pop.15.64),min=min(pop.15.64))
```
***Population growth***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(pop.growth), median=median(pop.growth), sd=sd(pop.growth), max=max(pop.growth),min=min(pop.growth))
```
***Population total***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(pop.total), median=median(pop.total), sd=sd(pop.total), max=max(pop.total),min=min(pop.total))
```
***% Rural population***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(pop.rural), median=median(pop.rural), sd=sd(pop.rural), max=max(pop.rural),min=min(pop.rural))
```
***% Urban population***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(pop.urban), median=median(pop.urban), sd=sd(pop.urban), max=max(pop.urban),min=min(pop.urban))
```
***Population density***
```{r}
wdi.df %>% group_by(year) %>% summarise(avg=mean(pop.density), median=median(pop.density), sd=sd(pop.density), max=max(pop.density),min=min(pop.density))
```


##References
[1] Investopedia, http://www.investopedia.com/articles/03/042303.asp<br>
[2] Population Reference Bureau, http://www.prb.org/Publications/Articles/2002/HowManyPeopleHaveEverLivedonEarth.aspx
[3] BRICS (Wikipedia), https://en.wikipedia.org/wiki/BRICS

